<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Russian KB for JP</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://fogup.github.io/fogup_web.png">
</head>
<body>
    <div class="container">
        <p class="ttl">RussIAN KeYboARd <span>FoR jp</span></p>

        <section class="display">
            <textarea class="disarea"></textarea>
        </section>

        <section class="keyboard">
            <div class="row1">
                <p class="tab">Tab</p>

                <p class="r1_k1">
                    <span class="active">й</span>
                    <span class="passive">Й</span>
                    <span class="assist">Q</span>
                </p>
                <p class="r1_k2">
                    <span class="active">ц</span>
                    <span class="passive">Ц</span>
                    <span class="assist">W</span>
                </p>
                <p class="r1_k3">
                    <span class="active">у</span>
                    <span class="passive">У</span>
                    <span class="assist">E</span>
                </p>
                <p class="r1_k4">
                    <span class="active">к</span>
                    <span class="passive">К</span>
                    <span class="assist">R</span>
                </p>
                <p class="r1_k5">
                    <span class="active">е</span>
                    <span class="passive">Е</span>
                    <span class="assist">T</span>
                </p>
                <p class="r1_k6">
                    <span class="active">н</span>
                    <span class="passive">Н</span>
                    <span class="assist">Y</span>
                </p>
                <p class="r1_k7">
                    <span class="active">г</span>
                    <span class="passive">Г</span>
                    <span class="assist">U</span>
                </p>
                <p class="r1_k8">
                    <span class="active">ш</span>
                    <span class="passive">Ш</span>
                    <span class="assist">I</span>
                </p>
                <p class="r1_k9">
                    <span class="active">щ</span>
                    <span class="passive">Щ</span>
                    <span class="assist">O</span>
                </p>
                <p class="r1_k10">
                    <span class="active">з</span>
                    <span class="passive">З</span>
                    <span class="assist">P</span>
                </p>
                <p class="r1_k11">
                    <span class="active">х</span>
                    <span class="passive">Х</span>
                    <span class="assist">@</span>
                </p>
                <p class="r1_k12">
                    <span class="active">ъ</span>
                    <span class="passive">Ъ</span>
                    <span class="assist">[</span>
                </p>

                <p class="backspace">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
                        <path d="M360-200q-20 0-37.5-9T294-234L120-480l174-246q11-16 28.5-25t37.5-9h400q33 0 56.5 23.5T840-680v400q0 33-23.5 56.5T760-200H360Zm400-80v-400 400Zm-400 0h400v-400H360L218-480l142 200Zm96-40 104-104 104 104 56-56-104-104 104-104-56-56-104 104-104-104-56 56 104 104-104 104 56 56Z"/>
                    </svg>
                </p>
            </div>
            <div class="row2">
                <p class="capslock">Caps<br>Lock</p>

                <p class="r2_k1">
                    <span class="active">ф</span>
                    <span class="passive">Ф</span>
                    <span class="assist">A</span>
                </p>
                <p class="r2_k2">
                    <span class="active">ы</span>
                    <span class="passive">Ы</span>
                    <span class="assist">S</span>
                </p>
                <p class="r2_k3">
                    <span class="active">в</span>
                    <span class="passive">В</span>
                    <span class="assist">D</span>
                </p>
                <p class="r2_k4">
                    <span class="active">а</span>
                    <span class="passive">А</span>
                    <span class="assist">F</span>
                </p>
                <p class="r2_k5">
                    <span class="active">п</span>
                    <span class="passive">П</span>
                    <span class="assist">G</span>
                </p>
                <p class="r2_k6">
                    <span class="active">р</span>
                    <span class="passive">Р</span>
                    <span class="assist">H</span>
                </p>
                <p class="r2_k7">
                    <span class="active">о</span>
                    <span class="passive">О</span>
                    <span class="assist">J</span>
                </p>
                <p class="r2_k8">
                    <span class="active">л</span>
                    <span class="passive">Л</span>
                    <span class="assist">K</span>
                </p>
                <p class="r2_k9">
                    <span class="active">д</span>
                    <span class="passive">Д</span>
                    <span class="assist">L</span>
                </p>
                <p class="r2_k10">
                    <span class="active">ж</span>
                    <span class="passive">Ж</span>
                    <span class="assist">;</span>
                </p>
                <p class="r2_k11">
                    <span class="active">э</span>
                    <span class="passive">Э</span>
                    <span class="assist">:</span>
                </p>

                <p class="enter">Enter</p>
            </div>
            <div class="row3">
                <p class="shift">Shift</p>

                <p class="r3_k1">
                    <span class="active">я</span>
                    <span class="passive">Я</span>
                    <span class="assist">Z</span>
                </p>
                <p class="r3_k2">
                    <span class="active">ч</span>
                    <span class="passive">Ч</span>
                    <span class="assist">X</span>
                </p>
                <p class="r3_k3">
                    <span class="active">с</span>
                    <span class="passive">С</span>
                    <span class="assist">C</span>
                </p>
                <p class="r3_k4">
                    <span class="active">м</span>
                    <span class="passive">М</span>
                    <span class="assist">V</span>
                </p>
                <p class="r3_k5">
                    <span class="active">и</span>
                    <span class="passive">И</span>
                    <span class="assist">B</span>
                </p>
                <p class="r3_k6">
                    <span class="active">т</span>
                    <span class="passive">Т</span>
                    <span class="assist">N</span>
                </p>
                <p class="r3_k7">
                    <span class="active">ь</span>
                    <span class="passive">Ь</span>
                    <span class="assist">M</span>
                </p>
                <p class="r3_k8">
                    <span class="active">б</span>
                    <span class="passive">Б</span>
                    <span class="assist">,</span>
                </p>
                <p class="r3_k9">
                    <span class="active">ю</span>
                    <span class="passive">Ю</span>
                    <span class="assist">.</span>
                </p>
                <p class="r3_k10">
                    <span class="active">ё</span>
                    <span class="passive">Ё</span>
                    <span class="assist">/</span>
                </p>
                
                <p class="shift">Shift</p>
            </div>
            <div class="row4">
                <p class="deleteall">Delete All</p>
                <p class="space">Space</p>
                <p class="copy">Copy</p>
                <p class="paste">Paste*</p>
            </div>
        </section>
    </div>

    <footer>
        <a href="https://fogup.github.io" class="link">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1927 603" enable-background="new 0 0 1927 603" xml:space="preserve">
                <path d="M43.269943,544.227844 C80.042870,443.810364 116.687378,343.761200 153.665863,242.800201 C145.309723,242.800201 137.748215,242.828293 130.187012,242.792786 C121.565796,242.752304 119.478447,239.999329 122.358673,232.051163 C131.117050,207.881851 139.953094,183.740494 148.829941,159.614410 C151.689102,151.843582 155.652496,149.114487 163.825714,149.049896 C171.650192,148.988068 179.475540,149.036545 187.587311,149.036545 C194.423157,130.259796 201.216980,111.603271 208.007080,92.945389 C211.806885,82.504250 215.685028,72.090622 219.373642,61.610313 C223.221176,50.678463 232.000107,44.425568 241.043411,38.413837 C241.925247,37.827614 243.251740,37.823730 244.386902,37.727795 C245.710785,37.615902 247.051239,37.699223 248.384506,37.699223 C679.197510,37.699108 1110.010498,37.699108 1540.823486,37.699108 C1542.939453,37.699108 1545.055420,37.699108 1547.057129,37.699108 C1547.183960,38.384384 1547.276245,38.565765 1547.235596,38.709648 C1544.592773,48.079330 1541.799927,57.409782 1539.352783,66.830086 C1538.324463,70.788757 1536.304688,71.805786 1532.292969,71.801163 C1425.798218,71.678284 1319.303467,71.703575 1212.808594,71.703598 C1038.650513,71.703644 864.492371,71.707649 690.334229,71.702209 C583.006042,71.698853 475.677826,71.674408 368.349640,71.684135 C360.857513,71.684814 353.360046,71.772568 345.878052,72.108765 C344.501312,72.170631 342.390503,73.330406 341.961639,74.483124 C332.897552,98.844994 324.024811,123.278061 315.134491,147.704407 C315.035004,147.977737 315.196991,148.346237 315.282837,149.043060 C334.370392,149.043060 353.499542,149.039536 372.628723,149.044312 C384.814758,149.047363 386.166901,150.989517 381.951630,162.574432 C373.707275,185.232712 365.436554,207.881393 357.172150,230.532379 C353.536255,240.497681 350.322754,242.796463 339.879517,242.805527 C320.221344,242.822556 300.563141,242.810425 280.596863,242.810425 C247.369858,333.817719 214.197739,424.674683 180.776550,516.213867 C182.882965,516.213867 184.633545,516.213867 186.384109,516.213867 C411.206848,516.213928 636.029541,516.202026 860.852234,516.306946 C864.982971,516.308899 866.834534,515.158569 868.251953,511.169525 C878.237854,483.064789 888.524902,455.067108 898.704773,427.031219 C899.319580,425.338043 899.840210,423.610657 900.700256,421.003052 C898.276001,421.003052 896.381775,421.003052 894.487549,421.003052 C841.990051,421.003021 789.492371,420.959991 736.995239,421.092621 C733.192322,421.102234 730.894409,420.068176 728.974182,416.742615 C725.146912,410.114197 721.128540,403.566528 716.739990,397.299957 C712.283875,390.936920 711.970703,384.523193 714.573608,377.447784 C722.942871,354.697693 731.144409,331.885925 739.437744,309.107819 C757.614441,259.184326 775.891968,209.297195 793.916321,159.318771 C797.145508,150.364624 802.132629,143.233688 809.958435,137.748962 C821.274475,129.818054 832.214905,121.352219 843.498474,113.373207 C845.633423,111.863525 848.619873,110.810860 851.215149,110.807343 C946.043884,110.678680 1040.872803,110.698074 1135.701660,110.710884 C1136.988525,110.711060 1138.275391,110.887123 1140.076416,111.018639 C1135.738647,122.963066 1131.548706,134.522934 1127.343018,146.077011 C1095.551514,233.416351 1063.704590,320.735596 1031.989258,408.102570 C1019.373230,442.856384 1007.251221,477.790466 994.494629,512.491943 C988.825867,527.912537 982.190552,542.980469 975.825623,558.137817 C975.333008,559.310913 973.611389,560.218201 972.264282,560.706848 C971.085693,561.134460 969.630005,560.799194 968.296753,560.799194 C660.311279,560.799377 352.325836,560.799377 44.340382,560.799377 C42.352634,560.799377 40.364887,560.799377 37.353004,560.799377 C39.412518,555.034424 41.277020,549.815308 43.269943,544.227844 M996.020142,145.485016 C978.206360,145.632919 960.387146,145.569427 942.581116,146.021835 C934.232422,146.233963 927.573486,150.376190 923.459839,157.726181 C920.877502,162.340195 918.702148,167.242874 916.881958,172.212997 C900.566711,216.762695 884.331116,261.341736 868.156982,305.942932 C860.271179,327.688599 852.245605,349.392609 844.912292,371.325775 C841.216614,382.379059 845.270508,387.687714 856.793152,387.998596 C869.272888,388.335297 881.780334,388.332245 894.256165,387.906097 C903.652283,387.585083 911.152527,383.308563 915.616455,374.679443 C917.288147,371.447937 918.869873,368.136078 920.116516,364.723450 C938.092102,315.516174 956.014526,266.289459 973.925354,217.058502 C982.074402,194.659592 990.196472,172.250732 998.227417,149.809387 C998.736511,148.386642 1001.629211,145.623550 996.020142,145.485016 z"/>
                <path d="M1587.500732,438.521851 C1584.403564,447.030487 1581.535278,455.208893 1578.480225,463.316864 C1566.665771,494.670776 1554.773315,525.995239 1542.978760,557.356628 C1542.128418,559.617676 1541.205566,560.863525 1538.454834,560.857117 C1497.788940,560.762329 1457.122559,560.785522 1416.456421,560.768616 C1415.976807,560.768372 1415.497192,560.608093 1414.395874,560.411621 C1414.977539,558.627502 1415.469727,556.952026 1416.065674,555.314331 C1469.445679,408.609100 1522.845459,261.910919 1576.146606,115.176994 C1577.364136,111.825050 1578.884155,110.614601 1582.524292,110.618614 C1677.189941,110.722992 1771.855591,110.718819 1866.521240,110.630157 C1869.935303,110.626961 1871.979614,111.628601 1873.740356,114.592636 C1877.992798,121.751060 1882.296875,128.919403 1887.169556,135.657562 C1892.202515,142.617432 1892.409302,149.550842 1889.546997,157.319565 C1878.114990,188.347198 1866.885254,219.449371 1855.572876,250.521118 C1839.030762,295.957642 1822.404663,341.363892 1806.002441,386.850800 C1802.830811,395.646576 1797.123657,401.939819 1790.297974,408.155762 C1778.032471,419.325684 1764.384888,422.338013 1748.033203,422.034882 C1698.384155,421.114441 1648.706787,421.760071 1599.041260,421.596954 C1594.809448,421.583069 1592.706055,422.773773 1591.653320,426.859833 C1590.660156,430.714783 1589.006836,434.399597 1587.500732,438.521851 M1689.561890,356.044312 C1711.363647,296.190582 1733.179810,236.342148 1754.941406,176.473740 C1756.811279,171.329315 1758.737915,166.144150 1759.899902,160.816864 C1762.072510,150.855850 1758.969727,146.499451 1748.853027,145.910660 C1738.227661,145.292252 1727.552612,145.399124 1716.899536,145.413467 C1698.769897,145.437866 1691.174561,150.414337 1684.966187,167.389236 C1658.521851,239.692490 1632.270386,312.066315 1605.953247,384.416138 C1604.100708,389.509064 1602.286011,394.615723 1600.323242,400.079163 C1619.117310,400.079163 1637.257935,400.230286 1655.394531,400.019958 C1665.545410,399.902222 1673.519897,395.285034 1677.734009,385.947449 C1682.031128,376.425995 1685.460571,366.513031 1689.561890,356.044312 z"/>
                <path d="M707.503662,254.485947 C691.081909,299.554321 674.785706,344.253021 658.591309,388.988586 C655.955811,396.268707 651.166260,401.595459 645.520630,406.760284 C633.180054,418.049896 619.359253,421.534515 602.507935,421.374908 C516.708191,420.562317 430.896606,420.973602 345.089355,421.084106 C341.133179,421.089203 338.772522,419.979095 336.671997,416.526917 C326.816284,400.329132 325.271729,402.332001 332.835175,381.626312 C360.065979,307.079285 387.165009,232.484039 414.210632,157.869598 C417.148895,149.763321 421.870911,143.349335 428.895905,138.348740 C440.416290,130.148193 451.667236,121.568542 463.210754,113.401619 C465.347870,111.889595 468.328522,110.816040 470.921906,110.811897 C554.063232,110.678940 637.204834,110.722389 720.346313,110.629616 C723.624634,110.625954 725.456299,111.720840 727.109009,114.461731 C731.662354,122.013359 736.268250,129.557205 741.322693,136.775497 C745.695679,143.020554 745.864929,149.234268 743.338379,156.116119 C733.018433,184.225113 722.835083,212.384247 712.602295,240.525208 C710.953735,245.058853 709.309448,249.594070 707.503662,254.485947 M540.279602,162.807922 C538.959167,166.042252 537.530151,169.237000 536.334534,172.516815 C516.630920,226.570953 496.922241,280.623291 477.296875,334.705841 C471.398712,350.959808 465.244232,367.148743 460.163818,383.661774 C456.698151,394.926300 460.642059,399.622101 472.422607,400.082092 C481.736481,400.445770 491.072357,400.281403 500.398529,400.286530 C521.902832,400.298340 528.526733,395.689667 536.035034,375.591156 C536.267517,374.968872 536.557373,374.367859 536.784546,373.743896 C556.430237,319.782074 576.128967,265.839447 595.681213,211.843781 C601.781738,194.996490 607.863525,178.124039 613.222961,161.033890 C616.225952,151.457993 612.434570,146.346832 602.576721,145.939148 C589.948303,145.416855 577.282654,145.565201 564.637573,145.744247 C553.145935,145.906921 545.271240,151.749191 540.279602,162.807922 z"/>
                <path d="M1113.645874,333.606934 C1140.337280,260.304596 1166.865967,187.358444 1193.351196,114.396545 C1194.230469,111.974197 1195.240845,110.621101 1198.230713,110.629166 C1238.559937,110.737907 1278.889648,110.701317 1319.219238,110.716927 C1320.027100,110.717232 1320.834961,110.911949 1322.147461,111.080917 C1317.881592,122.875412 1313.725708,134.425125 1309.528931,145.959915 C1282.224854,221.004333 1254.906738,296.043640 1227.621582,371.094940 C1226.488647,374.211182 1225.329712,377.372070 1224.719116,380.613190 C1223.354370,387.857544 1226.654175,392.434143 1233.949097,393.028748 C1240.077759,393.528229 1246.263794,393.395691 1252.424683,393.410431 C1264.423340,393.439087 1276.425415,393.216705 1288.419189,393.447937 C1291.909912,393.515198 1293.189087,392.295654 1294.331543,389.152985 C1327.471069,297.992340 1360.750854,206.882751 1393.873291,115.715981 C1395.208008,112.042206 1396.679321,110.571541 1400.822876,110.591202 C1439.818359,110.776230 1478.815186,110.701141 1517.811523,110.701149 C1519.422607,110.701149 1521.033569,110.701149 1523.314087,110.701149 C1519.022827,122.485565 1514.990967,133.553131 1510.962158,144.621780 C1478.014648,235.139648 1445.036133,325.646271 1412.228394,416.214813 C1410.816162,420.113739 1408.993896,421.091339 1405.078491,421.087006 C1306.087769,420.977661 1207.096924,420.976257 1108.106201,421.093903 C1104.271362,421.098480 1102.427124,419.561981 1100.071167,416.765930 C1090.702026,405.646179 1090.294189,394.352051 1096.027832,381.188232 C1102.718750,365.826691 1107.734009,349.735352 1113.645874,333.606934 z"/>
            </svg>
        </a>
    </footer>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {

            //クリック演出
            $(".keyboard p").on("mousedown", function() {
                $(this).addClass("pk_click");
            }).on("mouseup", function() {
                $(".keyboard p").removeClass("pk_click");
                $('textarea').focus();
            });

            //クリック対応
            function appendCharacter(keyClass, keys) {
                keys.forEach((char, index) => {
                    $(`.${keyClass}${index + 1}`).on("click", function() {
                        if ($('.upper').length > 0) {
                            char = char.toUpperCase();
                        }
                        let target = $('textarea')[0];
                        let pos = target.selectionStart;
                        let value = $(target).val();
                        let newValue = value.substring(0, pos) + char + value.substring(pos);
                        $(target).val(newValue);
                        target.setSelectionRange(pos + 1, pos + 1);
                        char = char.toLowerCase();

                        
                        // Shift / Capslock
                        $('.shift').removeClass('upper');
                        if ($('.upper').length) {
                            $('span.active').hide();
                            $('span.passive').show();
                        } else {
                            $('span.passive').hide();
                            $('span.active').show();
                        }
                    });
                });
            }
            const r1keys = ['й', 'ц', 'у', 'к', 'е', 'н', 'г', 'ш', 'щ', 'з', 'х', 'ъ'];
            const r2keys = ['ф', 'ы', 'в', 'а', 'п', 'р', 'о', 'л', 'д', 'ж', 'э'];
            const r3keys = ['я', 'ч', 'с', 'м', 'и', 'т', 'ь', 'б', 'ю', 'ё'];

            appendCharacter('r1_k', r1keys);
            appendCharacter('r2_k', r2keys);
            appendCharacter('r3_k', r3keys);


            function updateVisibility() {
                if ($('.upper').length) {
                    $('span.active').hide();
                    $('span.passive').show();
                } else {
                    $('span.passive').hide();
                    $('span.active').show();
                }
            }

            $('.shift').click(function() {
                $(this).toggleClass('upper');
                $('.capslock').removeClass('upper');
                updateVisibility();
            });

            $('.capslock').click(function() {
                $(this).toggleClass('upper');
                $('.shift').removeClass('upper');
                updateVisibility();
            });

            function spletters(sp_selector, sp_letter) {
                $(sp_selector).click(function() {
                    var val = $('textarea').val();
                    $('textarea').val(val + sp_letter);
                });
            }
            spletters('.enter', '\n');
            spletters('.space', ' ');
            spletters('.tab', '\t');
            $('.backspace').click(function() {
                var val = $('textarea').val();
                $('textarea').val(val.slice(0, -1));
            });
            $('.deleteall').click(function() {
                var value = $('textarea').val();
                $('textarea').val('');
            })
            $('.copy').click(function() {
                var copy_tempElement = $("<textarea>");
                $("body").append(copy_tempElement);
                copy_tempElement.val($('textarea').val()).select();
                document.execCommand("copy");
                copy_tempElement.remove();
                $(this).text('✓');

                setTimeout(() => {
                    $(this).text('Copy');
                }, 1000);
            })


            //キーボード対応
            $(document).keydown(function(event) {
                var val = $('textarea').val();
                $('textarea').focus();
                    
                var allowedKeys = [112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 49, 50, 51, 52, 53, 54, 55, 56, 57, 48, 189];
                // デフォルトのキー以外は無効にする
                if (allowedKeys.indexOf(event.keyCode) === -1) {
                    event.preventDefault();
                }
                
                //特殊文字keyboard
                if (event.key === 'Backspace') {
                    let target = event.target;
                    if (target.tagName.toLowerCase() === 'textarea' && target.selectionStart === target.selectionEnd && target.selectionStart > 0) {
                        let pos = target.selectionStart;
                        let value = $(target).val();
                        let newValue = value.substring(0, pos - 1) + value.substring(pos);
                        $(target).val(newValue);
                        target.setSelectionRange(pos - 1, pos - 1);
                    }
                } else if (event.key === ' ') {
                    $('textarea').val(val + ' ');
                } else if (event.key === 'Tab') {
                    $('textarea').val(val + '\t');
                } else if (event.key === 'Enter') {
                    let textarea = $('textarea');
                    let start = textarea[0].selectionStart;
                    let end = textarea[0].selectionEnd;
                    let value = textarea.val();
                    textarea.val(value.substring(0, start) + "\n" + value.substring(end));
                    textarea[0].selectionStart = textarea[0].selectionEnd = start + 1;
                } else if ((event.which === 37 || event.which === 39) && event.target.selectionStart === event.target.selectionEnd) {
                    event.target.setSelectionRange(event.target.selectionStart + (event.which === 37 ? -1 : 1), event.target.selectionStart + (event.which === 37 ? -1 : 1));
                }

                //一般文字keyboard
                let keyCode = event.keyCode || event.which;
                let inputMap = {
                    81: 'й',  // q
                    87: 'ц',  // w
                    69: 'у',  // e
                    82: 'к',  // r
                    84: 'е',  // t
                    89: 'н',  // y
                    85: 'г',  // u
                    73: 'ш',  // i
                    79: 'щ',  // o
                    80: 'з',  // p
                    192: 'х',  // @
                    219: 'ъ', // [
                    65: 'ф',  // a
                    83: 'ы',  // s
                    68: 'в',  // d
                    70: 'а',  // f
                    71: 'п',  // g
                    72: 'р',  // h
                    74: 'о',  // j
                    75: 'л',  // k
                    76: 'д',  // l
                    187: 'ж', // ;
                    186: 'э',  // :
                    90: 'я',  // z
                    88: 'ч',  // x
                    67: 'с',  // c
                    86: 'м',  // v
                    66: 'и',  // b
                    78: 'т',  // n
                    77: 'ь',  // m
                    188: 'б', // ,
                    190: 'ю', // .
                    191: 'ё'  // /
                };
                if (inputMap[keyCode] && $('.upper').length > 0) {
                    var char = inputMap[keyCode];
                    var isLowerCase = /[а-яё]/.test(char);
                    if (isLowerCase) {
                        var charCode = char.charCodeAt(0) - 32; // 大文字に変換
                        var upperCaseChar = String.fromCharCode(charCode);
                        inputMap[keyCode] = upperCaseChar;
                    }
                    $('textarea').val($('textarea').val() + inputMap[keyCode]);
                }
                if (inputMap[keyCode] && $('.upper').length === 0) {
                    let target = $('textarea')[0];
                    let pos = target.selectionStart;
                    let value = $(target).val();
                    let newValue = value.substring(0, pos) + inputMap[keyCode] + value.substring(pos);
                    $(target).val(newValue);
                    target.setSelectionRange(pos + 1, pos + 1);
                    $('textarea').focus();
                }


                // Shift / Capslock
                $('.shift').removeClass('upper');
                
                if ($('.upper').length) {
                    $('span.active').hide();
                    $('span.passive').show();
                } else {
                    $('span.passive').hide();
                    $('span.active').show();
                }

            });
            $(document).on('keydown keyup', function(event) {
                if (event.key === 'Shift') {
                    $('.shift').toggleClass('upper', event.type === 'keydown');

                    if ($('.upper').length) {
                        $('span.active').hide();
                        $('span.passive').show();
                    } else {
                        $('span.passive').hide();
                        $('span.active').show();
                    }
                }
            });

        })


    </script>
</body>
</html>
